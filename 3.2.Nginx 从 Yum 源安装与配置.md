# RHEL/CentOS 从 Yum 源安装与配置 Nginx

## 一、安装 Nginx

### 1.1. 添加 Nginx Yum 源

centos 7

```shell
cat >/etc/yum.repos.d/nginx.repo <<'EOF'
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
enabled=1
EOF
```

rhel 8

```shell
cat >/etc/yum.repos.d/nginx.repo <<'EOF'
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/rhel/8/$basearch/
gpgcheck=0
enabled=1
EOF
```

### 1.2. 安装 Nginx

```shell
yum -y install nginx
```

### 1.3. 启动 Nginx

```shell
systemctl start nginx && \
systemctl enable nginx
```

### 1.4. 防火墙设置

```shell
sudo firewall-cmd --permanent --zone=public --add-service=http
sudo firewall-cmd --permanent --zone=public --add-service=https
sudo firewall-cmd --reload
```

## 二、设置 Nginx

```shell
mkdir -p /etc/nginx/{sites-available,sites-enabled,conf.d,rewrite-rules,ssl-certs} && \
chmod 755 /etc/nginx/{sites-available,sites-enabled,conf.d,rewrite-rules,ssl-certs}
```

vim /etc/nginx/nginc.conf

```shell
include /etc/nginx/sites-enabled/*.conf;
```

证书

```shell
chmod 777 /etc/nginx/ssl-certs && \
chmod o+t /etc/nginx/ssl-certs

openssl dhparam -out /etc/nginx/ssl-certs/dhparam.pem 2048
curl https://ssl-config.mozilla.org/ffdhe2048.txt > /etc/nginx/ssl-certs/dhparam.pem
```

错误页面

```shell
error_page 400 /400.html;
error_page 403 /403.html;
error_page 404 /404.html;
error_page 500 /500.html;
error_page 502 /502.html;
location ~ ^/(400|403|404|500|502)\.html$ {
    root /etc/nginx/error-pages;
}
```

### 2.1. 网址：

<http://server_domain_name_or_IP/>

```shell
ip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\/.*$//'
```

### 2.2. 配置文件路径

- 默认网站根目录 `/usr/share/nginx/html`
- 默认网站根配置文件 `/etc/nginx/conf.d/default.conf`
- 其他网站配置文件 `/etc/nginx/conf.d/`
- 全局配置文件 `/etc/nginx/nginx.conf`

参考文档：

- <http://nginx.org/en/linux_packages.html>
- <https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-centos-7>
