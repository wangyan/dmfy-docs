# Linux 用户与组管理和权限分配

## 一、添加、修改、删除用户

### 1.1. 添加用户和组

```bash
#useradd wangyan
adduser wangyan
```

- 自动创建 /home/wangyan 目录
- 自动创建 wangyan 用户组
- 默认使用 /bin/bash
- 自动创建 /var/spool/mail/dmfy

或者使用以下命令

```bash
groupadd wangyan
useradd -g wangyan -d /home/wangyan -s /bin/bash wangyan
```

### 1.2. 修改用户

```bash
id wangyan # 查看信息
usermod -h # 帮助信息

#usermod -G root wangyan
gpasswd -a wangyan root #将 wangyan 加入 root 用户组中
gpasswd -d wangyan root #将 wangyan 从 root 用户组中删除
```

### 1.3. 删除用户

`-r` 表示连同`/home/wangyan`目录一起删除

```bash
userdel -r wangyan
```

## 二、文件与目录权限分配

### 2.1. 一般权限：

r(4) w(2) x(1)

具体说明（略）

### 2.2. 特殊权限

*SUID：* 让二进制文件的执行者临时拥有所有者权限。

例子：普通用户执行 passwd 后，一样有 shadow 的写入权限。

```bash
ls -l /bin/passwd;ls -l /etc/shadow

# -rwsr-xr-x. 1 root root 27832 Jan 30  2014 /bin/passwd
# ----------. 1 root root 1066 Feb 23 23:06 /etc/shadow
```

权限标识： s 或者 S（原先没有执行权）

```bash
chmod u+s filename
chmod u-s filename
```

*SGID：* 让二进制文件的执行者临时拥有属主权限；或者让目录下的文件自动该目录的用户组。

权限标识： s 或者 S（原先没有执行权）

```bash
chmod g+s filename
chmod g-s filename
```

*SBID：* 保护位，只能删除自己的文件。

```bash
ls -ld /tmp
# drwxrwxrwt. 7 root root 181 Feb 23 03:40 /tmp

# 权限标识： t 或者 T（原先没有执行权）
chmod o+t testdir/
```

### 2.3. 隐藏属性

```bash
chattr +i xxx #不能修改或者目录下不能新建、删除
chattr +a xxx #只能追加内容
```

```bash
lsattr  xxx #显示隐藏属性
```

### 2.4. 访问控制列表

```bash
setfacl -Rm u:wangyan:rwx /root
```

```bash
getfacl  /root
```

## 三、权限分离

### 3.1. 三员管理

等保要求：安全主管、安全管理员、系统管理员、网络管理员、数据库管理员

三员管理：系统管理员、安全管理员、安全审计员

<a href="https://cdn.nlark.com/yuque/0/2019/png/102854/1550939541388-b427424e-568f-44e7-bc09-285f13a1a771.png">
    <img src="https://cdn.nlark.com/yuque/0/2019/png/102854/1550939541388-b427424e-568f-44e7-bc09-285f13a1a771.png" width="300" />
</a>

(一) 系统管理员：主要负责系统的日常运行维护工作。

- 包括安装、配置、升级、维护、运行管理；
- 用户增加或删除；
- 系统数据备份、运行日志审查和运行情况监控；
- 应急条件下的安全恢复。

(二) 安全管理员：主要负责系统的日常安全管理工作。

- 包括用户权限的授予与撤销；
- 关键业务流程权限控制；
- 系统安全事件的审计、分析和处理；
- 应急条件下的安全恢复。

(二) 安全审计员

主要负责对系统管理员和安全管理员的操作行为进行审计跟踪、分析和监督检查，及时发现违规行为，并定期向安全主管汇报情况。

### 3.2. 用户创建

```bash
groupadd -g 2001 sysadmin && useradd -g 2001 -u 2001 sysadmin && \
groupadd -g 2002 safeadmin && useradd -g 2002 -u 2002 safeadmin && \
groupadd -g 2003 safecheck && useradd -g 2003 -u 2003 safecheck
```

生成密码：

```bash
pwmake 128
passwd sysadmin # 修改密码
passwd safeadmin
passwd safecheck
```

### 3.3. sudo 权限分配

```bash
# 核对权限
ls -al /etc/sudoers
-r--r-----. 1 root root 4326 Feb 23 23:20 /etc/sudoers

# sudo 权限分配
visudo
```

/etc/sudoers

```bash
# 用户完全权限
root    ALL=(ALL)       ALL
XXXX ALL=(ALL)       ALL

# 用户组完全权限
%wheel  ALL=(ALL)       ALL

# 用户组免密码
%wheel        ALL=(ALL)       NOPASSWD: ALL

# 用户免密码
XXXX    ALL=(ALL)       NOPASSWD: ALL

#系统管理员和安全管理员权限
User_Alias ADMINS = sysadmin, safeadmin, safecheck
ADMINS ALL = NETWORKING, SOFTWARE, SERVICES, LOCATE, STORAGE, DELEGATING, PROCESSES, DRIVERS
```
加入 wheel 组

```bash
gpasswd -a wangyan wheel
```

## 四、其他

注释掉不需要的用户和组

```bash
vim /etc/passwd
adm、 lp、sync、 shutdown、 halt、operator、games、ftp

vim /etc/group
adm、lp、cdrom、floppy、games、ftp
```
