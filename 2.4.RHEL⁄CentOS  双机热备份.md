# RHEL⁄CentOS  双机热备份

## 一、网络配置

### 1.1. 备份

```bash
cp /etc/sysconfig/network-scripts/ifcfg-em1 /etc/sysconfig/network-scripts/ifcfg-em1.bak &&\
cp /etc/sysconfig/network-scripts/ifcfg-em2 /etc/sysconfig/network-scripts/ifcfg-em2.bak &&\
cp /etc/sysconfig/network-scripts/ifcfg-em3 /etc/sysconfig/network-scripts/ifcfg-em3.bak &&\
cp /etc/sysconfig/network-scripts/ifcfg-em4 /etc/sysconfig/network-scripts/ifcfg-em4.bak
```

### 1.2. 网络

> 注意：请先修改 UUID

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em1<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
NAME=em1
UUID=0df7fcd8-900f-495c-aeb9-46b82407b0da
DEVICE=em1
ONBOOT=yes
IPADDR=192.168.10.245
PREFIX=24
NETMASK=255.255.255.0
GATEWAY=192.168.10.1
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em2<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em2
UUID=6ec8f74b-a2db-4355-890d-53f79a52e41b
DEVICE=em2
ONBOOT=yes
IPADDR=192.168.20.245
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em3<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em3
UUID=97028e19-4f5f-47e8-abcb-961374b4ffea
DEVICE=em3
ONBOOT=yes
IPADDR=192.168.30.245
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em4<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em4
UUID=12409bf6-c869-4508-ba49-fea969b0d3e1
DEVICE=em4
ONBOOT=yes
IPADDR=192.168.40.245
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=114.114.114.114
EOF
```

### 1.2. S2网络

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em1<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
NAME=em1
UUID=0df7fcd8-900f-495c-aeb9-46b82407b0da
DEVICE=em1
ONBOOT=yes
IPADDR=192.168.10.246
PREFIX=24
NETMASK=255.255.255.0
GATEWAY=192.168.10.1
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em2<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em2
UUID=6ec8f74b-a2db-4355-890d-53f79a52e41b
DEVICE=em2
ONBOOT=yes
IPADDR=192.168.20.246
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em3<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em3
UUID=97028e19-4f5f-47e8-abcb-961374b4ffea
DEVICE=em3
ONBOOT=yes
IPADDR=192.168.30.246
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=1.1.1.1
EOF
```

```bash
cat >/etc/sysconfig/network-scripts/ifcfg-em4<<'EOF'
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=no
IPV4_FAILURE_FATAL=no
NAME=em4
UUID=12409bf6-c869-4508-ba49-fea969b0d3e1
DEVICE=em4
ONBOOT=yes
IPADDR=192.168.40.246
PREFIX=24
NETMASK=255.255.255.0
PEERDNS=no
DNS1=114.114.114.114
EOF
```

## 二、Hosts 设置

```shell
# s1
echo '192.168.10.246 s2' >> /etc/hosts

# s2
echo '192.168.10.245 s1' >> /etc/hosts
```

## 三、MirrorHA 安装

```shell
tar -zxf MirrorHA-R5-352-RHEL7-x86_64.tar.gz

chmod 755 /opt/MirrorHA/ha/bin/{app_start.sh,app_stop.sh,ha_ag_app.sh}
```